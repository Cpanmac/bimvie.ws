<div class="login container">
    <div class="span5">
    	<form class="form-horizontal">
    	<legend>Login</legend>
		<div class="control-group">
			<label class="control-label" for="inputServer">Server</label>
			<div class="controls">
				<div class="btn-group">
					<input type="text" id="inputServer" placeholder="BIMserver">
					<a class="btn dropdown-toggle btn" title="Suggestions" data-toggle="dropdown"><i class="icon-star"></i></a>
					<ul id="serverDropdown" class="dropdown-menu">
						<li><a address="http://localhost:8080">Localhost 8080</a></li>
						<li><a address="http://bimserver.logic-labs.nl">Logic Labs Demo BIMserver</a></li>
						<li><a address="http://e-bouw.org:8080/">E-Bouw BIMserver</a></li>
						<li><a address="http://demo.bimserver.org">TNO Demo BIMserver</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="inputEmail">Email</label>
			<div class="controls">
				<input type="email" id="inputEmail" placeholder="Email">
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="inputPassword">Password</label>
			<div class="controls">
				<input type="password" id="inputPassword" placeholder="Password">
			</div>
		</div>
		<div class="control-group">
			<div class="controls">
				<label class="checkbox"> <input type="checkbox"
					id="rememberMe"> Remember me
				</label>
				<button type="button" class="btn loginButton">Sign in</button>
			</div>
		</div>
	</form>
  </div>
</div>
<script>
function Login(address, username) {
	var othis = this;
	
	this.login = function(address) {
		var timeoutId = window.setTimeout(function() {
			notifier.error("Could not connect");
		}, 3000);
		$.getScript(address + "/js/bimserverapi.js").done(function(){
			window.clearTimeout(timeoutId);
			bimServerApi = new BimServerApi(address, notifier);
			bimServerApi.call("ServiceInterface", "getServerInfo", {}, function(serverInfo){
				if (serverInfo.serverState == "NOT_SETUP") {
					$(".indexcontainer").load("setup.html", function(){
						new Setup(address);
					});
				} else if (serverInfo.serverState == "UNDEFINED") {
				} else if (serverInfo.serverState == "MIGRATION_REQUIRED") {
				} else if (serverInfo.serverState == "MIGRATION_IMPOSSIBLE") {
				} else if (serverInfo.serverState == "FATAL_ERROR") {
				} else if (serverInfo.serverState == "RUNNING") {
					var username = $("#inputEmail").val()
					bimServerApi.login(username, $("#inputPassword").val(), $("#rememberMe").is(":checked"), function(data){
						$(".indexcontainer").load("main.html", function(){
							new Main(address, username).show();
						});
					});
				}
			});
		});
	}

	if (address != null) {
		$("#inputServer").val(address);
	}
	if (username != null) {
		$("#inputEmail").val(username);
		$("#inputPassword").focus();
	}
	
	$("#serverDropdown").click(function(event){
		event.preventDefault();
		$("#inputServer").val($(event.target).attr("address"));
	});
	$(".loginButton").click(function(){
		othis.login($("#inputServer").val());
	});
	
	$("#inputServer").focus();
}
</script>