<div class="users">
	<div class="well well-small">
		<button class="addUserButton btn">Add user</button>
	</div>
	<table class="usersTable table table-striped table-hover">
		<thead>
			<tr><th>Name</th><th>Actions</th></tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>
<script>
function Users(main) {
	var othis = this;

	this.userClick = function(event) {
		if (!$(event.target).is("a, button, span.caret")) {
			main.showUser($(this).parents("tr").andSelf().data("user"), event)
			othis.close();
		}
	};
	
	this.close = function() {
		bimServerApi.unregister(othis.newLogAction);
	};

	this.addUser = function(user) {
		var userRow = $("<tr>");
		userRow.click(othis.userClick);
		userRow.data("user", user);
		userRow.append("<td>" + user.name + "</td>");
		userRow.append(newDropdownTd("Actions"));
		$(".usersTable tbody").append(userRow);
	};
	
	bimServerApi.call("ServiceInterface", "getAllUsers", {}, function(data){
		data.forEach(function(user){
			othis.addUser(user);
		});
	});
	
	this.newLogAction = function(uuid, logAction, serviceIdentifier, profileIdentifier, token, apiUrl){
		if (logAction.__type == "SNewUserAdded") {
			bimServerApi.call("ServiceInterface", "getUserByUoid", {uoid: logAction.userId}, function(data){
				othis.addUser(data);
			});
		}
	};
	
	bimServerApi.register("NotificationInterface", "newLogAction", othis.newLogAction);
	$(".users .addUserButton").click(main.showAddUser);
}
</script>