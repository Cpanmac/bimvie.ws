<div class="project">
	<h1></h1>
	<div class="btn-group well well-small">
		<button class="btn checkinButton">Checkin</button>
		<button class="btn addServiceButton">Add service</button>
		<button class="btn addSubProjectButton">Add sub project</button>
		<button class="btn show3DButton">Show in 3D</button>
	</div>
	<ul class="nav nav-tabs">
	  <li class="detailsLink active"><a>Details</a></li>
	  <li class="subprojectsLink"><a>Subprojects</a></li>
	  <li class="revisionsLink"><a>Revisions</a></li>
	  <li class="checkoutsLink"><a>Checkouts</a></li>
	  <li class="servicesLink"><a>Services</a></li>
	  <li class="queryLink"><a>Query</a></li>
	  <li class="extendedDataLink"><a>Extended Data</a></li>
	  <li class="browserLink"><a>Browse</a></li>
	  <!--  <li class="surferLink"><a>Surf</a></li>-->
	  <li class="usersLink"><a>Users</a></li>
	  <li class="logLink"><a>Log</a></li>
	</ul>
	<div class="content">
		<div class="tab-pane details">
			Not implemented
		</div>
		<div class="tab-pane subprojects initialhide">
			<div class="well well-small nosubprojects">No sub projects</div>
			<table class="subprojectsTable initialhide table table-striped table-hover">
				<thead>
					<tr>
						<th>Name</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane revisions initialhide">
			<div class="well well-small norevisions">No revisions</div>
			<table class="revisionsTable initialhide table table-striped table-hover">
				<thead>
					<tr>
						<th>Id</th>
						<th>Date</th>
						<th>User</th>
						<th>Comment</th>
						<th>Size</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane checkouts initialhide">
			<div class="well well-small nocheckouts">No checkouts</div>
			<table class="checkoutsTable initialhide table table-striped table-hover">
				<thead>
					<tr>
						<th>Id</th>
						<th>Date</th>
						<th>User</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane services initialhide">
			<div class="well well-small noservices">No services</div>
			<table class="servicesTable initialhide table table-striped table-hover">
				<thead>
					<tr>
						<th>Name</th>
						<th>Profile</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
		<div class="tab-pane query initialhide" id="query">
			Not implemented
		</div>
		<div class="tab-pane extendeddata initialhide">
			<div class="well well-small message"></div>
			<div class="extendeddatacontainer"></div>
		</div>
		<div class="tab-pane browser initialhide" id="browser">
			<div class="well well-small message"></div>
			<div class="browsercontainer"></div>
		</div>
		<div class="tab-pane users initialhide" id="users">
			<div class="linkspacer">
				<a class="addUserLink">Add user</a>
			</div>
			<div class="noUsersMessage"></div>
			<div class="addUserToProjectDiv initialhide">
				<form class="inline-form">
					<select></select>
					<button class="btn">Add</button>
				</form>
			</div>
			<div class="nousers well well-small">
				No users
			</div>
			<table class="table usersTable table-striped table-hover">
				<thead>
					<tr>
						<th>Name</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	  	<div class="tab-pane surfer initialhide" id="surfer">
		</div>
		<div class="tab-pane logholder initialhide" id="log">
		</div>
	</div>
	<div class="initialhide dropdowntemplaterevision">
		<div class="btn-group">
			<button class="btn downloadCheckoutRevisionButton">Download</button>
			<a class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
			<ul class="dropdown-menu">
			</ul>
		</div>
	</div>
	<div class="initialhide dropdowntemplateproject">
		<div class="btn-group">
			<button class="btn">Delete</button>
			<button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
			<ul class="dropdown-menu">
			</ul>
		</div>
	</div>
</div>
<script>
var Project = function(containerDiv, main, project) {
	var othis = this;
	othis.tabChanger = new TabChanger(containerDiv.find(".nav"), containerDiv.find(".content"));
	othis.lastRevision = null;

	this.close = function () {
		if (othis.project != null) {
			Global.bimServerApi.unregisterNewRevisionOnSpecificProjectHandler(othis.project.oid, othis.newRevisionOnSpecificProjectHandler);
			if (othis.project.lastRevisionId != -1) {
				Global.bimServerApi.unregisterNewExtendedDataOnRevisionHandler(othis.project.lastRevisionId, othis.newExtendedDataOnRevisionHandler);
			}
		}
		$(".sidespan").empty();
	};

	this.show = function() {
		if (typeof project == "number" || typeof project == "string") {
			othis.reloadProject(project);
		} else {
			othis.project = project;
			othis.updateProject();
		}
	};

	this.revisionClick = function(event) {
		if (!$(event.target).is("a, button, span.caret")) {
			main.showRevision($(this).parents("tr").andSelf().data("revision"), null, true);
			othis.close();
		}
	};

	this.loadDetails = function(callback, alterState) {
		othis.tabChanger.changeTab($(".detailsLink"), null, $(".details"), function(){
			if (alterState) {
				pushHistoryAppend({tab: "details"});
			}
			return $(".details");
		}, callback);
	};

	this.projectClick = function(event) {
		if (!$(event.target).is("a, button, span.caret")) {
			main.showProject($(this).parents("tr").andSelf().data("project"), event);
			othis.close();
		}
	};
	
	this.addSubProject = function(subProject) {
		containerDiv.find(".nosubprojects").hide();
		containerDiv.find(".subprojectsTable").show();
		var subProjectRow = $("<tr class=\"project\">");
		subProjectRow.click(othis.projectClick);
		subProjectRow.data("project", subProject);
		
		subProjectRow.append("<td>" + subProject.name + "</td>");

		var actions = $("<td></td>");
		var dd = $(".dropdowntemplateproject").clone();
		dd.removeClass("dropdowntemplateproject");
		dd.show();
		actions.append(dd);
		subProjectRow.append(actions);

		containerDiv.find(".subprojectsTable").append(subProjectRow);
	};
	
	this.loadSubProjects = function(callback, alterState) {
		othis.tabChanger.changeTab($(".subprojectsLink"), null, $(".subprojects"), function(){
			Global.bimServerApi.call("ServiceInterface", "getSubProjects", {poid: othis.project.oid}, function(data){
				containerDiv.find(".subprojectsTable tr.project").remove();
				data.forEach(function(subProject){
					othis.addSubProject(subProject);
				});
			});
			if (alterState) {
				pushHistoryAppend({tab: "subprojects"});
			}
			return $(".subprojects");
		}, callback);
	};
	
	this.userRowClick = function(event) {
		if (!$(event.target).is("a, button, span.caret")) {
			main.showUser($(this).data("user"), null, true);
			othis.close();
		}
	};

	this.userClick = function(event) {
		main.showUser($(this).data("user"), null, true);
		othis.close();
	};

	this.revokeUser = function() {
		var user = $(this).parents("tr").data("user");
		Global.bimServerApi.call("ServiceInterface", "removeUserFromProject", {
			uoid: user.oid,
			poid: othis.project.oid
		}, function(data){
			othis.loadUsers();
		});
	};
	
	this.addUser = function(user) {
		containerDiv.find(".nousers").hide();
		containerDiv.find(".usersTable").show();
		
		var tr = $("<tr>");
		tr.data("user", user);
		tr.click(othis.userRowClick);
		tr.append("<td>" + user.name + "</td>");
		tr.append(newButtonTd("Revoke", othis.revokeUser));
		containerDiv.find(".usersTable").append(tr);
	};
	
	this.share = function(roid) {
		var div = $("<div class=\"modal fade\">");
		$(document.body).append(div);
		div.load(Global.baseDir + "share.html", function(){
			new Share(roid);
		}).modal({keyboard:true});
	};

	this.addRevision = function(revision) {
		containerDiv.find(".norevisions").hide();
		containerDiv.find(".revisionsTable").show();
		var revisionRow = $("<tr>");
		revisionRow.data("revision", revision);
		revisionRow.click(othis.revisionClick);

		revisionRow.append("<td>" + revision.id + "</td>");
		revisionRow.append("<td><span title=\"" + formatDateTime(new Date(revision.date)) + "\" class=\"timespan\" datetime=\"" + revision.date + "\">" + formatTimeSpan(new Date().getTime() - revision.date, false) + "</span></td>");
		var userTd = $("<td></td>");
		var userA = $("<a>loading...</a>");
		userA.attr("uoid", revision.userId);
		userA.click(othis.userClick);
		userTd.append(userA);
		loadUser(userA);
		if (revision.serviceId != -1) {
			var serviceLink = $("<a>loading...</a>");
			serviceLink.attr("soid", revision.serviceId);
			serviceLink.click(othis.serviceClick);
			loadService(serviceLink);
			userTd.append(" (");
			userTd.append(serviceLink);
			userTd.append(")");
		}
		revisionRow.append(userTd);
		revisionRow.append("<td>" + revision.comment + "</td>");
		revisionRow.append("<td>" + revision.size + "</td>");

		var actions = newSplitDropDownTd("Download", othis.downloadCheckoutClick);
		
		actions.find("button.dropdown-toggle").click(function(){
			Global.bimServerApi.call("ServiceInterface", "getAllServicesOfProject", {poid: othis.project.oid}, function(data){
				actions.find("ul li").remove();
				var added = 0;
				data.forEach(function(service){
					if (service.trigger == "NEW_REVISION") {
						var li = $("<li><a>Run \"" + service.name + "\"</a></li>");
						added++;
						li.find("a").click(function(event){
							Global.bimServerApi.call("ServiceInterface", "triggerNewRevision", {roid: revision.oid, soid: service.oid}, function(data){
							});
						});
						actions.find("ul").append(li);
					}
				});
				if (added == 0) {
					var li = $("<li><a>No services configured</a></li>");
					actions.find("ul").append(li);
				}
				var shareLi = $("<li><a>Share...</a></li>");
				shareLi.find("a").click(function(){
					othis.share(revision.oid);
				});
				actions.find("ul").append(shareLi);
				
				if (Settings.get3DViewerUrl != null) {
					var viewLi = $("<li><a>View in 3D</a></li>");
					viewLi.find("a").click(function(){
						window.open(Settings.get3DViewerUrl(Global.bimServerApi, revision.oid), '_blank');
					});
					actions.find("ul").append(viewLi);
				}
			});
		});
		
		revisionRow.append(actions);
		containerDiv.find(".revisionsTable tbody").prepend(revisionRow);
	};

	this.addCheckout = function(checkout) {
		containerDiv.find(".nocheckouts").hide();
		containerDiv.find(".checkoutsTable").show();
		var checkoutRow = $("<tr>");
		checkoutRow.data("checkout", checkout);
		checkoutRow.data("revision", checkout.revision);
		checkoutRow.click(othis.checkoutClick);

		checkoutRow.append("<td>" + checkout.revision.id + "</td>");
		checkoutRow.append("<td><span title=\"" + formatDateTime(new Date(checkout.date)) + "\" class=\"timespan\" datetime=\"" + checkout.date + "\">" + formatTimeSpan(new Date().getTime() - checkout.date, false) + "</span></td>");
		var userTd = $("<td></td>");
		var userA = $("<a>loading...</a>");
		userA.attr("uoid", checkout.userId);
		userA.click(othis.userClick);
		userTd.append(userA);
		loadUser(userA);
		checkoutRow.append(userTd);

		var actions = newSplitDropDownTd("Download", othis.downloadCheckoutClick);
		checkoutRow.append(actions);
		containerDiv.find(".checkoutsTable tbody").prepend(checkoutRow);
	};

	this.serviceRowClick = function(event){
		if (!$(event.target).is("a, button, span.caret")) {
			var service = $(this).parents("tr").andSelf().data("service");
			event.preventDefault();
			containerDiv.find(".services").load(Global.baseDir + "service.html", function(){
				new Service(main, service);
			});
		}
	};
	
	this.serviceClick = function(){
		othis.showService($(this).data("service"));
	};
	
	this.showService = function(callback, alterState) {
		othis.tabChanger.changeTab($(".servicesLink"), $(".services"), function(){
			if (alterState) {
				pushHistoryAppend({tab: "services"});
			}
			return new Service(main, service);
		}, callback);
	};

	this.createServiceLink = function(soid) {
		var link = $("<a></a>");
		link.attr("soid", soid);
		loadService(link);
		link.click(othis.serviceClick);
		return link;
	};

	this.triggerService = function() {
		var service = $(this).parents("tr").data("service");
		alert("Triggering service "  + service);
	};
	
	this.addService = function(service) {
		containerDiv.find(".noservices").hide();
		containerDiv.find(".servicesTable").show();
		var tr = $("<tr class=\"service\">");
		tr.data("service", service);
		tr.click(othis.serviceRowClick);
		var td = $("<td soid=\"" + service.oid + "\"></td>");
		loadService(td);
		tr.append(td);
		tr.append("<td>" + service.profileName + "</td>");
//		var dropdowntd = newSplitDropDownTd("Trigger", othis.triggerService); 
//		tr.append(dropdowntd);
		containerDiv.find(".servicesTable tbody").append(tr);
	};
	
	this.loadExtendedData = function(callback, alterState) {
		$(".extendeddata .message").html("Showing extended data for revision " + othis.lastRevision.id);
		othis.tabChanger.changeTab($(".extendedDataLink"), "extendeddatalist.html", $(".extendeddatacontainer"), function(){
			if (alterState) {
				pushHistoryAppend({tab: "extendeddata"});
			}
			$(".extendeddata").show();
			return new ExtendedDataList(main, othis.lastRevision, othis);
		}, callback);
	};
	
	this.loadRevisions = function(callback, alterState) {
		othis.tabChanger.changeTab($(".revisionsLink"), null, $(".revisions"), function(){
			Global.bimServerApi.call("Bimsie1ServiceInterface", "getAllRevisionsOfProject", {poid: othis.project.oid}, function(data){
				containerDiv.find(".revisionsTable tbody tr").remove();
				data.forEach(function(revision){
					othis.addRevision(revision);
				});
			});
			if (alterState) {
				pushHistoryAppend({tab: "revisions"});
			}
			return $(".revisions");
		}, callback);
	};

	this.loadCheckouts = function(callback, alterState) {
		othis.tabChanger.changeTab($(".checkoutsLink"), null, $(".checkouts"), function(){
			Global.bimServerApi.call("ServiceInterface", "getAllCheckoutsOfProject", {poid: othis.project.oid}, function(data){
				containerDiv.find(".checkoutsTable tbody tr").remove();
				data.forEach(function(checkout){
					othis.addCheckout(checkout);
				});
			});
			if (alterState) {
				pushHistoryAppend({tab: "checkouts"});
			}
			return $(".checkouts");
		}, callback);
	};

	this.loadUsers = function(callback, alterState) {
		othis.tabChanger.changeTab(containerDiv.find(".usersLink"), null, containerDiv.find(".users"), function(){
			Global.bimServerApi.call("ServiceInterface", "getAllAuthorizedUsersOfProject", {poid: othis.project.oid}, function(data){
				containerDiv.find(".usersTable tbody tr").remove();
				data.forEach(function(user){
					othis.addUser(user);
				});
			});
			if (alterState) {
				pushHistoryAppend({tab: "users"});
			}
			return $(".users");
		}, callback);
	};

	this.loadServices = function(callback, alterState) {
		othis.tabChanger.changeTab($(".servicesLink"), null, $(".services"), function(){
			Global.bimServerApi.call("ServiceInterface", "getAllServicesOfProject", {poid: othis.project.oid}, function(data){
				containerDiv.find(".servicesTable tr.service").remove();
				data.forEach(function(service){
					othis.addService(service);
				});
			});
			if (alterState) {
				pushHistoryAppend({tab: "services"});
			}
			return $(".services");
		}, callback);
	};

	this.downloadCheckoutClick = function(event) {
		event.preventDefault();
		othis.showDownloadCheckoutPopup($(this).parents("tr").andSelf().data("revision").oid);
	};
	
	this.showDownloadCheckoutPopup = function(roid) {
		var div = $("<div class=\"modal fade\">");
		$(document.body).append(div);
		var params = {
			downloadType: "single",
			allowCheckouts: true,
			poid: othis.project.oid,
			roid: roid
		};
		div.load(Global.baseDir + "download.html", function(){
			new Download($(this), params);
		}).modal({keyboard:true});
	};
	
	this.showCheckinPopup = function() {
		var div = $("<div class=\"modal fade\">");
		$(document.body).append(div);
		div.load(Global.baseDir + "checkin.html", function(){
			new Checkin($(this), othis.project, function(){
			});
		}).modal({keyboard:true});
	};

	this.reloadProject = function(poid) {
		if (poid == null) {
			poid = othis.project.oid;
		}
		Global.bimServerApi.call("Bimsie1ServiceInterface", "getProjectByPoid", {poid: poid}, function(project){
			othis.project = project;
			othis.updateProject();
		});
	};
	
	this.addServiceClick = function() {
		main.showAddService(othis.project, null, true);
	};
	
	this.updateProject = function() {
		Global.bimServerApi.registerNewRevisionOnSpecificProjectHandler(othis.project.oid, othis.newRevisionOnSpecificProjectHandler);
		if (othis.project.lastRevisionId != -1) {
			Global.bimServerApi.registerNewExtendedDataOnRevisionHandler(othis.project.lastRevisionId, othis.newExtendedDataOnRevisionHandler);
		}

		containerDiv.find("h1").html(othis.project.name);
		containerDiv.find(".subprojectsLink a").html("Sub Projects" + (othis.project.subProjects.length == 0 ? "" : (" (" + othis.project.subProjects.length + ")")));
		containerDiv.find(" .revisionsLink a").html("Revisions" + (othis.project.revisions.length == 0 ? "" : (" (" + othis.project.revisions.length + ")")));
		containerDiv.find(".servicesLink a").html("Services" + (othis.project.services.length == 0 ? "" : (" (" + othis.project.services.length + ")")));
		if (othis.project.lastRevisionId != -1) {
			Global.bimServerApi.call("Bimsie1ServiceInterface", "getRevision", {roid: othis.project.lastRevisionId}, function(data){
				othis.lastRevision = data;
				containerDiv.find(".browserLink").show();
				containerDiv.find(".surferLink").show();
				containerDiv.find(".queryLink").show();
				containerDiv.find(".extendedDataLink").show();
				containerDiv.find(" .extendedDataLink a").html("Extended Data" + (data.extendedData.length == 0 ? "" : (" (" + data.extendedData.length + ")")));
				othis.loadHistory();
			});
			Global.bimServerApi.call("ServiceInterface", "getAllCheckoutsOfProject", {poid: othis.project.oid}, function(checkouts){
				containerDiv.find(".checkoutsLink a").html("Checkouts" + (checkouts == null || checkouts.length == 0 ? "" : (" (" + checkouts.length + ")")));
			});
		} else {
			containerDiv.find(".browserLink").hide();
			containerDiv.find(".surferLink").hide();
			containerDiv.find(".queryLink").hide();
			containerDiv.find(".extendedDataLink").hide();
			othis.loadHistory();
		}
		
		Global.bimServerApi.call("ServiceInterface", "getAllRelatedProjects", {poid: othis.project.oid}, function(list){
			var lastParent = -1;
			var div = $("<div>");
			var ul = $("<ul class=\"p-1\"></ul>");
			div.append(ul);
			list.forEach(function(smallProject){
				var li = $("<li><a>" + smallProject.name + "</a><ul class=\"p" + smallProject.oid + "\"></ul></li>");
				li.find("a").data("poid", smallProject.oid);
				if (smallProject.oid == othis.project.oid) {
					li.find("a").css("font-weight", "bold");
				}
				li.find("a").click(function(event){
					main.showProject($(this).data("poid"), null, true);
				});
				div.find(".p" + smallProject.parentId).append(li);
			});
			$(".sidespan").html(div);
		});
		
		if (Settings.get3DViewerUrl != null && othis.project.lastRevisionId != -1) {
			containerDiv.find(".show3DButton").click(function(){
				var url = Settings.get3DViewerUrl(Global.bimServerApi, othis.project.lastRevisionId);
				window.open(url);
			});
		} else {
			containerDiv.find(".show3DButton").hide();
		}
	};

	this.loadHistory = function(){
		var history = History.getState().data;
		if (history.tab == "details") {
			othis.loadDetails();
		} else if (history.tab == "query") {
			othis.loadQuery();
		} else if (history.tab == "browser") {
			othis.loadBrowser(function(){
				this.loadFromHistory();
			});
		} else if (history.tab == "checkouts") {
			othis.loadCheckouts();
		} else if (history.tab == "extendeddata") {
			othis.loadExtendedData();
		} else if (history.tab == "services") {
			othis.loadServices();
		} else if (history.tab == "users") {
			othis.loadUsers();
		} else if (history.tab == "revisions") {
			othis.loadRevisions();
		} else if (history.tab == "subprojects") {
			othis.loadSubProjects();
		} else if (history.tab == "log") {
			othis.loadLog();
		}
	};
	
	this.loadBrowser = function(callback, alterState) {
		$(".browser .message").html("Showing data for revision " + othis.lastRevision.id);
		othis.tabChanger.changeTab($(".browserLink"), "browser.html", $(".browsercontainer"), function(){
			if (alterState) {
				pushHistoryAppend({tab: "browser"});
			}
			$(".browser").show();
			return new Browser($(this), othis.lastRevision);
		}, callback);
	};

	this.loadQuery = function(callback, alterState) {
		othis.tabChanger.changeTab($(".queryLink"), "query.html", $(".query"), function(){
			if (alterState) {
				pushHistoryAppend({tab: "query"});
			}
			return new Query($(this), main, othis.project.oid, othis.lastRevision.oid);
		}, callback);
	};

	this.loadLog = function(callback, alterState) {
		othis.tabChanger.changeTab($(".logLink"), "log.html", $(".logholder"), function(){
			var settings = {
				getTopicsMethod: "getProgressTopicsOnProject",
				getTopicsArguments: {poid: othis.project.oid},
				registerFunction: function(newChangeProgressHandler, closedChangeProgressHandler){
					Global.bimServerApi.registerChangeProgressProjectHandler(othis.project.oid, function(poid, topicId){
						newChangeProgressHandler(topicId);
					}, function(poid, topicId){
						closedChangeProgressHandler(topicId);
					})
				},
				unregisterFunction: function(newChangeProgressHandler, closedChangeProgressHandler){
					Global.bimServerApi.unregisterChangeProgressProjectHandler(othis.project.oid, newChangeProgressHandler, closedChangeProgressHandler)
				}
			};
			if (alterState) {
				pushHistoryAppend({tab: "log"});
			}
			return new Log($(this), settings, main);
		}, callback);
	};

	this.addSubProjectClick = function(event) {
		main.showAddProject(null, othis.project, true);
	};

	this.loadSurfer = function(callback, alterState) {
		othis.tabChanger.changeTab($(".surferLink"), "surfer.html", $(".surfer"), function(){
			if (alterState) {
				pushHistoryAppend({tab: "surfer"});
			}
			return new Surfer(othis.lastRevision);
		}, callback);
	};
	
	this.addUserLinkClick = function() {
		Global.bimServerApi.call("ServiceInterface", "getAllNonAuthorizedUsersOfProject", {poid: othis.project.oid}, function(data){
			containerDiv.find(".addUserToProjectDiv select option").remove();
			if (data.length == 0) {
				containerDiv.find(".noUsersMessage").html("No users available to add");
				containerDiv.find(".addUserLink").show();
				containerDiv.find(".addUserToProjectDiv").hide();
			} else {
				data.forEach(function(user){
					var option = $("<option value=\"" + user.oid + "\">" + user.name + "</option>");
					containerDiv.find(".addUserToProjectDiv select").append(option);
				});
				containerDiv.find(".addUserLink").hide();
				containerDiv.find(".addUserToProjectDiv").show();
			}
		});
	};

	this.addUserToProject = function(event){
		event.preventDefault();
		Global.bimServerApi.call("ServiceInterface", "addUserToProject", {
			uoid: containerDiv.find(".addUserToProjectDiv select option:selected").val(),
			poid: othis.project.oid
		}, function(data){
			othis.loadUsers();
			othis.addUserLinkClick();
		});
	};
	
	containerDiv.find(".detailsLink").click(function(){othis.loadDetails(null, true)});
	containerDiv.find(".subprojectsLink").click(function(){othis.loadSubProjects(null, true);});
	containerDiv.find(".revisionsLink").click(function(){othis.loadRevisions(null, true);});
	containerDiv.find(".checkoutsLink").click(function(){othis.loadCheckouts(null, true);});
	containerDiv.find(".servicesLink").click(function(){othis.loadServices(null, true);});
	containerDiv.find(".queryLink").click(function(){othis.loadQuery(null, true);});
	containerDiv.find(".extendedDataLink").click(function(){othis.loadExtendedData(null, true);});
	containerDiv.find(".browserLink").click(function(){othis.loadBrowser(function(){
		this.loadFromHistory();
	}, true);});
	containerDiv.find(".usersLink").click(function(){othis.loadUsers(null, true);});
	containerDiv.find(".surferLink").click(function(){othis.loadSurfer(null, true);});
	containerDiv.find(".logLink").click(function(){othis.loadLog(null, true);});

	containerDiv.find(".addUserToProjectDiv button").click(othis.addUserToProject);
	
	containerDiv.find(".addUserLink").click(othis.addUserLinkClick);
	
	containerDiv.find(".checkinButton").click(othis.showCheckinPopup);
	containerDiv.find(".addServiceButton").click(othis.addServiceClick);
	containerDiv.find(".addSubProjectButton").click(othis.addSubProjectClick);

	this.newRevisionOnSpecificProjectHandler = function(poid, roid){
		Global.bimServerApi.call("Bimsie1ServiceInterface", "getRevision", {roid: roid}, function(data){
			othis.reloadProject(data.projectId);
			othis.addRevision(data);
		});
	};
	this.newExtendedDataOnRevisionHandler = function(roid, edid){
		Global.bimServerApi.call("Bimsie1ServiceInterface", "getExtendedData", {oid: edid}, function(data){
			othis.reloadProject(data.projectId);
		});
	};
}
</script>