<div class="selectserver container">
    <div class="span7">
    	<div class="header"></div>
		<form class="form-horizontal">
		   	<legend>Select server TEST</legend>
			<div class="serverAddressDiv control-group">
				<label class="control-label" for="inputServer">Server</label>
				<div class="controls">
					<div class="btn-group input-append">
						<div class="input-prepend input-append">
		 					<span class="add-on">http://</span>
							<input type="text" id="inputServer" class="address" placeholder="BIMserver">
						</div>
						<a class="btn dropdown-toggle btn" title="Suggestions" data-toggle="dropdown"><i class="icon-star"></i></a>
						<ul id="serverDropdown" class="dropdown-menu">
						</ul>
					</div>
				</div>
			</div>
			<div class="control-group">
				<div class="controls">
					<button type="button" class="btn selectServerButton btn-primary">Select server</button>
				</div>
			</div>
		</form>
	</div>
</div>
<script>
function SelectServer(address) {
	var othis = this;

	$(".header").load(Global.baseDir + "header.html");
	
	$("#serverDropdown").click(function(event){
		event.preventDefault();
		$("#inputServer").val($(event.target).attr("address"));
	});

	pushHistory({page: "SelectServer"}, "Select BIMsie Server");
	
	$(".selectServerButton").click(function(){
		var address = $("#inputServer").val();
		loadBimServerApi("http://" + address, Global.notifier, function(serverInfo){
			if (serverInfo.serverState == "NOT_SETUP") {
				$(".indexcontainer").load(Global.baseDir + "setup.html", function(){
					new Setup(address);
				});
			} else if (serverInfo.serverState == "UNDEFINED") {
			} else if (serverInfo.serverState == "MIGRATION_REQUIRED") {
			} else if (serverInfo.serverState == "MIGRATION_IMPOSSIBLE") {
			} else if (serverInfo.serverState == "FATAL_ERROR") {
			} else if (serverInfo.serverState == "RUNNING") {
				$(".indexcontainer").load(Global.baseDir + "login.html", function(){
					othis.current = new Login(address);
				});
			}
		}, function(){
			
		});
	});
	
	$(".address").focus();
	
	Settings.getServerList(function(servers){
		$("#serverDropdown li").remove();
		servers.forEach(function(server){
			$("#serverDropdown").append("<li><a address=\"" + stripHttp(server.address) + "\">" + server.name + "</a></li>");
		});
	});
}
</script>